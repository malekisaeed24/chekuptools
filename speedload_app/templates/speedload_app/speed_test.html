<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست سرعت بارگذاری سایت</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="font-family: Arial, sans-serif; background-color: #f0f0f0; color: #333; margin: 0; padding: 20px;">

    <div style="max-width: 600px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); text-align: center;">
        <h1 style="font-size: 1.5rem; color: #444;">تست سرعت بارگذاری سایت</h1>
        <form id="speedTestForm" method="post">
            {% csrf_token %}
            <input type="text" name="url" id="urlInput" placeholder="آدرس سایت را وارد کنید" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
            <button type="submit" style="background-color: #007bff; color: white; border: none; padding: 10px 20px; font-size: 1rem; border-radius: 5px; cursor: pointer;">شروع تست سرعت</button>
        </form>

        <p id="loadTime" style="margin: 20px 0; padding: 10px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 5px;"></p>
        <canvas id="loadChart" width="400" height="200" style="margin-top: 20px;"></canvas>
    </div>

    <script>
        document.getElementById('speedTestForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const url = document.getElementById('urlInput').value;
            if (!url) {
                alert('لطفا آدرس سایت را وارد کنید');
                return;
            }

            fetch('/speed-test/', {
                method: 'POST',
                body: new FormData(this)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('loadTime').innerText = data.error;
                    return;
                }

                const { html, css, js, img } = data;

                document.getElementById('loadTime').innerText = `زمان بارگذاری HTML: ${html.time} میلی‌ثانیه، حجم: ${html.size} بایت`;

                // رسم نمودار
                const ctx = document.getElementById('loadChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['CSS', 'JavaScript', 'Images', 'HTML'],
                        datasets: [
                            {
                                label: 'زمان بارگذاری (میلی‌ثانیه)',
                                data: [css.time, js.time, img.time, html.time],
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'حجم (بایت)',
                                data: [css.size, js.size, img.size, html.size],
                                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'مقدار (میلی‌ثانیه / بایت)'
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => {
                document.getElementById('loadTime').innerText = 'خطایی رخ داد: ' + error;
            });
        });
    </script>

</body>
</html>
